<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Introduction
  #

Red Hat OpenShift Service on AWS (ROSA) provides fully-managed cluster upgrades. The ROSA Site Reliability Engineering (SRE) Team will monitor and manage all ROSA cluster upgrades. Customers get status emails from the SRE team before, during, and after the upgrade. These updates can be scheduled from the OpenShift Cluster Manager (OCM) or from the ROSA CLI.
During ROSA upgrades, one node is upgraded at a time. This is done to ensure customer applications are not impacted during the update, when deployed in a highly-available and fault-tolerant method."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/docs/lab_4_cluster_upgrade/"><meta property="og:site_name" content="ROSA HCP Workshop"><meta property="og:title" content="Upgrade ROSA HCP Cluster"><meta property="og:description" content="Introduction # Red Hat OpenShift Service on AWS (ROSA) provides fully-managed cluster upgrades. The ROSA Site Reliability Engineering (SRE) Team will monitor and manage all ROSA cluster upgrades. Customers get status emails from the SRE team before, during, and after the upgrade. These updates can be scheduled from the OpenShift Cluster Manager (OCM) or from the ROSA CLI.
During ROSA upgrades, one node is upgraded at a time. This is done to ensure customer applications are not impacted during the update, when deployed in a highly-available and fault-tolerant method."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Lab 4 - Upgrade ROSA HCP Cluster | ROSA HCP Workshop</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/docs/lab_4_cluster_upgrade/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.ca88b67f90f2aca8c1ccdfcf37144b0397e3ad38fe5d87c9ecc7beed176c7a67.js integrity="sha256-yoi2f5DyrKjBzN/PNxRLA5fjrTj+XYfJ7Me+7Rdsemc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>ROSA HCP Workshop</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/lab_1_explore_rosa/>Lab 1 - Explore the environment</a></li><li><a href=/docs/lab_2_cluster_creation_hcp/>Lab 2 - Create a ROSA HCP Cluster</a></li><li><a href=/docs/lab_3_access_cluster/>Lab 3 - Access ROSA HCP Cluster</a></li><li><a href=/docs/lab_4_cluster_upgrade/ class=active>Lab 4 - Upgrade ROSA HCP Cluster</a></li><li><a href=/docs/lab_5_managing_worker_nodes-copy/>Lab 5 - Managing Worker Nodes</a></li><li><a href=/docs/lab_6_labeling_nodes/>Lab 6 - Labeling Worker Nodes</a></li><li><a href=/docs/lab_7_autoscaling/>Lab 7 - Autoscaling ROSA HCP Cluster</a></li><li><a href=/docs/lab_8_cloudwatch/>Lab 8 - Configure Red Hat OpenShift Logging with AWS Cloudwatch</a></li><li><a href=/docs/lab_9_deploy_app/>Lab 9 - Deploy an application with AWS Database</a></li><li><a href=/docs/lab_10_openshift_gitops/>Lab 10 - Deploy an application with Red Hat OpenShift GitOps</a></li><li><a href=/docs/lab_11_network_policy/>Lab 11 - Secure your applications with Network Policies</a></li><li><a href=/docs/lab_12_resilient_app/>Lab 12 - Make your application resilient</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab 4 - Upgrade ROSA HCP Cluster</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#upgrade-using-the-rosa-command-line-interface>Upgrade using the rosa command line interface</a></li><li><a href=#additional-resources>Additional Resources</a><ul><li><a href=#red-hat-openshift-upgrade-graph>Red Hat OpenShift Upgrade Graph</a></li><li><a href=#links-to-documentation>Links to Documentation</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>Red Hat OpenShift Service on AWS (ROSA) provides fully-managed cluster upgrades. The ROSA Site Reliability Engineering (SRE) Team will monitor and manage all ROSA cluster upgrades. Customers get status emails from the SRE team before, during, and after the upgrade. These updates can be scheduled from the OpenShift Cluster Manager (OCM) or from the ROSA CLI.</p><p>During ROSA upgrades, one node is upgraded at a time. This is done to ensure customer applications are not impacted during the update, when deployed in a highly-available and fault-tolerant method.</p><p>There are two ways to upgrade a ROSA cluster - using OpenShift Cluster Manager or using the <code>rosa</code> CLI. In this lab environment we do not have access to the OpenShift Cluster Manager so we will use the rosa CLI.</p><h2 id=upgrade-using-the-rosa-command-line-interface>Upgrade using the rosa command line interface
<a class=anchor href=#upgrade-using-the-rosa-command-line-interface>#</a></h2><ol><li><p>Remind yourself of the version of your cluster:</p><pre><code>   oc version
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>Client Version: 4.13.26
</span></span><span style=display:flex><span>Kustomize Version: v4.5.7
</span></span><span style=display:flex><span>Server Version: 4.13.26
</span></span><span style=display:flex><span>Kubernetes Version: v1.26.11+7dfc52e
</span></span></code></pre></div></li><li><p>Find out the available versions</p><pre><code>   rosa list upgrades --cluster rosa-${GUID}
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>VERSION  NOTES
</span></span><span style=display:flex><span>4.16.14  recommended
</span></span></code></pre></div><p>Note: Depending on when you run this command the available version list may be longer than just the next release.</p></li><li><p>You probably don’t want to actually upgrade the cluster right now since that may disrupt your lab environment. Luckily it is possible to schedule an update at a less inconvenient time.</p><p>Get a date and time that is 24 hours from now:</p><pre><code>   export UPGRADE_DATE=$(date -d &quot;+24 hours&quot; '+%Y-%m-%d')
   export UPGRADE_TIME=$(date '+%H:%M')

   echo Date: ${UPGRADE_DATE}, Time: ${UPGRADE_TIME}
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>Date: 2023-04-18, Time: 19:51
</span></span></code></pre></div></li><li><p>Now schedule the cluster upgrade to a version shown in the list of available versions you found earlier (in the example above that is 4.13.25) - answer y when prompted if you really want to upgrade. To be clear, you will need to change the value specified in the &ndash;version line below to be something from the list upgrades command you ran before.</p><pre><code>   rosa upgrade cluster \
     -c rosa-${GUID} \
     --version 4.16.14 \
     --mode auto \
     --schedule-date ${UPGRADE_DATE} \
     --schedule-time ${UPGRADE_TIME} \
     --control-plane 
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>I: Ensuring account and operator role policies for cluster &#39;25216tq1cq14etbb8rl91kqg2s1u4ssj&#39; are compatible with upgrade.
</span></span><span style=display:flex><span>I: Account roles/policies for cluster &#39;25216tq1cq14etbb8rl91kqg2s1u4ssj&#39; are already up-to-date.
</span></span><span style=display:flex><span>I: Operator roles/policies associated with the cluster &#39;25216tq1cq14etbb8rl91kqg2s1u4ssj&#39; are already up-to-date.
</span></span><span style=display:flex><span>I: Account and operator roles for cluster &#39;rosa-bhjks&#39; are compatible with upgrade
</span></span><span style=display:flex><span>? Are you sure you want to upgrade cluster to version &#39;4.13.1&#39;? Yes
</span></span><span style=display:flex><span>I: Upgrade successfully scheduled for cluster &#39;rosa-6n4s8&#39;
</span></span></code></pre></div></li></ol><p>Congratulations! You’ve successfully scheduled an upgrade of your cluster for tomorrow at this time. While the workshop environment will be deleted before then, you now have the experience to schedule upgrades in the future.</p><h2 id=additional-resources>Additional Resources
<a class=anchor href=#additional-resources>#</a></h2><h3 id=red-hat-openshift-upgrade-graph>Red Hat OpenShift Upgrade Graph
<a class=anchor href=#red-hat-openshift-upgrade-graph>#</a></h3><p>Occasionally, you may be not be able to go directly from your current version to a desired version. In these cases, you must first upgrade your cluster from your current version, to an intermediary version, and then to your desired version. To help you navigate these decisions, you can take advantage of the <a href=https://access.redhat.com/labs/ocpupgradegraph/update_path_rosa>Red Hat OpenShift Upgrade Graph Tool</a> (Red Hat portal login required).</p><p>In this scenario to upgrade your cluster from version 4.11.0 to 4.12.15, you must first upgrade to 4.11.39, then you can upgrade to 4.12.15. The ROSA Upgrade Graph Tool helps you easily see which version you should upgrade to.</p><h3 id=links-to-documentation>Links to Documentation
<a class=anchor href=#links-to-documentation>#</a></h3><p><a href=https://docs.openshift.com/rosa/upgrading/rosa-upgrading-sts.html>Upgrading ROSA clusters with STS</a></p><p><a href=https://docs.openshift.com/rosa/upgrading/rosa-upgrading-sts.html#rosa-upgrade-ocm_rosa-upgrading-sts>Scheduling individual upgrades through the OpenShift Cluster Manager console</a></p><p><a href=https://docs.openshift.com/container-platform/latest/updating/understanding_updates/understanding-update-channels-release.html>Understanding update channels and releases</a></p><h2 id=summary>Summary
<a class=anchor href=#summary>#</a></h2><p>Here you learned:</p><ul><li><p>All upgrades are monitored and managed by the ROSA SRE Team</p></li><li><p>Use OpenShift Cluster Manager (OCM) to schedule an upgrade for your ROSA cluster</p></li><li><p>Explore the OpenShift Upgrade Graph Tool to see available upgrade paths</p></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#upgrade-using-the-rosa-command-line-interface>Upgrade using the rosa command line interface</a></li><li><a href=#additional-resources>Additional Resources</a><ul><li><a href=#red-hat-openshift-upgrade-graph>Red Hat OpenShift Upgrade Graph</a></li><li><a href=#links-to-documentation>Links to Documentation</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></aside></main></body></html>