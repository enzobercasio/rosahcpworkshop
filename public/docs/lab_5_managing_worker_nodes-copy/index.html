<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Introduction
  #

When deploying your ROSA cluster, you can configure many aspects of your worker nodes, but what happens when you need to change your worker nodes after they’ve already been created? These activities include scaling the number of nodes, changing the instance type, adding labels or taints, just to name a few.
Many of these changes are done using Machine Pools. Machine Pools ensure that a specified number of Machine replicas are running at any given time. Think of a Machine Pool as a &ldquo;template&rdquo; for the kinds of Machines that make up the worker nodes of your cluster. If you’d like to learn more, see the Red Hat documentation on worker node management."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/docs/lab_5_managing_worker_nodes-copy/"><meta property="og:site_name" content="ROSA HCP Workshop"><meta property="og:title" content="Managing Worker Nodes"><meta property="og:description" content="Introduction # When deploying your ROSA cluster, you can configure many aspects of your worker nodes, but what happens when you need to change your worker nodes after they’ve already been created? These activities include scaling the number of nodes, changing the instance type, adding labels or taints, just to name a few.
Many of these changes are done using Machine Pools. Machine Pools ensure that a specified number of Machine replicas are running at any given time. Think of a Machine Pool as a “template” for the kinds of Machines that make up the worker nodes of your cluster. If you’d like to learn more, see the Red Hat documentation on worker node management."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Lab 5 - Managing Worker Nodes | ROSA HCP Workshop</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/docs/lab_5_managing_worker_nodes-copy/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.184ab0ba1ad480f500e7286e5b89e84a3efeb92b43ce0d91fe93f2e68bd397ec.js integrity="sha256-GEqwuhrUgPUA5yhuW4noSj7+uStDzg2R/pPy5ovTl+w=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>ROSA HCP Workshop</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/lab_1_explore_rosa/>Lab 1 - Explore the environment</a></li><li><a href=/docs/lab_2_cluster_creation_hcp/>Lab 2 - Create a ROSA HCP Cluster</a></li><li><a href=/docs/lab_3_access_cluster/>Lab 3 - Access ROSA HCP Cluster</a></li><li><a href=/docs/lab_4_cluster_upgrade/>Lab 4 - Upgrade ROSA HCP Cluster</a></li><li><a href=/docs/lab_5_managing_worker_nodes-copy/ class=active>Lab 5 - Managing Worker Nodes</a></li><li><a href=/docs/lab_6_labeling_nodes/>Lab 6 - Labeling Worker Nodes</a></li><li><a href=/docs/lab_7_autoscaling/>Lab 7 - Autoscaling ROSA HCP Cluster</a></li><li><a href=/docs/lab_8_cloudwatch/>Lab 8 - Configure Red Hat OpenShift Logging with AWS Cloudwatch</a></li><li><a href=/docs/lab_9_deploy_app/>Lab 9 - Deploy an application with AWS Database</a></li><li><a href=/docs/lab_10_openshift_gitops/>Lab 10 - Deploy an application with Red Hat OpenShift GitOps</a></li><li><a href=/docs/lab_11_network_policy/>Lab 11 - Secure your applications with Network Policies</a></li><li><a href=/docs/lab_12_resilient_app/>Lab 12 - Make your application resilient</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab 5 - Managing Worker Nodes</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#scaling-worker-nodes>Scaling Worker Nodes</a><ul><li><a href=#via-the-cli>Via the CLI</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>When deploying your ROSA cluster, you can configure many aspects of your worker nodes, but what happens when you need to change your worker nodes after they’ve already been created? These activities include scaling the number of nodes, changing the instance type, adding labels or taints, just to name a few.</p><p>Many of these changes are done using Machine Pools. Machine Pools ensure that a specified number of Machine replicas are running at any given time. Think of a Machine Pool as a &ldquo;template&rdquo; for the kinds of Machines that make up the worker nodes of your cluster. If you’d like to learn more, see the <a href=https://docs.openshift.com/rosa/rosa_cluster_admin/rosa_nodes/rosa-managing-worker-nodes.html>Red Hat documentation on worker node management</a>.</p><p>Here are some of the advantages of using ROSA Machine Pools to manage the size of your cluster</p><ul><li><p>Scalability - A ROSA Machine Pool enables horizontal scaling of your cluster. It can easily add or remove worker nodes to handle the changes in workload. This flexibility ensures that your cluster can dynamically scale to meet the needs of your applications</p></li><li><p>High Availability - ROSA Machine Pools supports the creation of 3 replicas of workers across different availability zones. This redundancy helps ensure high availability of applications by distributing workloads.</p></li><li><p>Infrastructure Diversity - ROSA Machine Pools allow you to provision worker nodes of different instance types. This enables you to leverage the best kind of instance family for different workloads.</p></li><li><p>Integration with Cluster Autoscaler - ROSA Machine Pools seamlessly integrate with the Cluster Autoscaler feature, which automatically adjusts the number of worker nodes based on the current demand. This integration ensures efficient resource utilization by scaling the cluster up or down as needed, optimizing costs and performance.</p></li></ul><h2 id=scaling-worker-nodes>Scaling Worker Nodes
<a class=anchor href=#scaling-worker-nodes>#</a></h2><h3 id=via-the-cli>Via the CLI
<a class=anchor href=#via-the-cli>#</a></h3><ol><li><p>First, let’s see what Machine Pools already exist in our cluster. To do so, run the following command</p><pre><code>rosa list machinepools -c rosa-${GUID}
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>ID       AUTOSCALING  REPLICAS  INSTANCE TYPE  LABELS    TAINTS    AVAILABILITY ZONE  SUBNET                    DISK SIZE  VERSION  AUTOREPAIR  
</span></span><span style=display:flex><span>workers  No           2/2       m5.xlarge                          ap-southeast-1c    subnet-0c6e1f11632b044a8  300 GiB    4.15.34  Yes    
</span></span></code></pre></div></li><li><p>Now, let’s take a look at the nodes inside of the ROSA cluster that have been created according to the instructions provided by the above MachineSets. To do so, run the following command:</p><pre><code>oc get nodes
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>NAME                                            STATUS     ROLES    AGE   VERSION
</span></span><span style=display:flex><span>ip-10-0-0-237.ap-southeast-1.compute.internal   Ready      worker   14m   v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-42.ap-southeast-1.compute.internal    Ready      worker   24s   v1.28.13+2ca1a23
</span></span></code></pre></div><p>For this workshop, we’ve deployed your ROSA cluster with 2 total worder nodes.</p></li><li><p>Now that we know that we have two worker nodes, let’s create a MachinePool to add a new worker node using the ROSA CLI. To do so, run the following command</p><pre><code>rosa create machinepool -c rosa-${GUID} --replicas 1 --name workshop --instance-type m5.xlarge
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>I: Fetching instance types
</span></span><span style=display:flex><span>I: Machine pool &#39;workshop&#39; created successfully on cluster &#39;rosa-6n4s8&#39;
</span></span><span style=display:flex><span>I: To view all machine pools, run &#39;rosa list machinepools -c rosa-6n4s8&#39;     
</span></span></code></pre></div><p>This command adds a single m5.xlarge instance to the first AWS availability zone in the region your cluster is deployed in.</p></li><li><p>Now, let’s scale up our selected MachinePool from one to two machines. To do so, run the following command</p><pre><code>rosa update machinepool -c rosa-${GUID} --replicas 2 workshop
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>I: Updated machine pool &#39;workshop&#39; on cluster &#39;rosa-6n4s8&#39;
</span></span></code></pre></div></li><li><p>Now that we’ve scaled the MachinePool to two machines, we can see that the node is already being created. First, let’s quickly check the output of the <code>oc get nodes</code> command we ran earlier</p><pre><code>oc get nodes
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>NAME                                            STATUS   ROLES    AGE     VERSION
</span></span><span style=display:flex><span>ip-10-0-0-237.ap-southeast-1.compute.internal   Ready    worker   20m     v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-42.ap-southeast-1.compute.internal    Ready    worker   6m53s   v1.28.13+2ca1a23  
</span></span><span style=display:flex><span>ip-10-0-0-111.ap-southeast-1.compute.internal   NotReady   worker   0s      v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-111.ap-southeast-1.compute.internal   NotReady   worker   0s      v1.28.13+2ca1a23
</span></span></code></pre></div></li><li><p>Let the above command run until all nodes are in the Ready state. This means that they are ready and available to run Pods in the cluster. Hit CTRL-C to exit the oc command.</p></li><li><p>We don’t need these extra worker nodes for now so let’s scale the cluster back down to a total of 3 worker nodes by scaling down the &ldquo;Workshop&rdquo; Machine Pool. To do so, run the following command:</p><pre><code>rosa update machinepool -c rosa-${GUID} --replicas 1 workshop
</code></pre></li><li><p>Now that we’ve scaled the MachinePool (and therefore the MachineSet) back down to one machine, we can see the change reflected in the cluster almost immediately. Let’s quickly check the output of the same command we ran before:</p><pre><code> oc get nodes -w
</code></pre><p>Sample Output</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tpl data-lang=tpl><span style=display:flex><span>NAME                                            STATUS   ROLES    AGE    VERSION
</span></span><span style=display:flex><span>ip-10-0-0-111.ap-southeast-1.compute.internal   Ready    worker   4m4s   v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-237.ap-southeast-1.compute.internal   Ready    worker   25m    v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-42.ap-southeast-1.compute.internal    Ready    worker   12m    v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-74.ap-southeast-1.compute.internal    Ready    worker   4m3s   v1.28.13+2ca1a23
</span></span><span style=display:flex><span>ip-10-0-0-74.ap-southeast-1.compute.internal    Ready,SchedulingDisabled   worker   4m45s   v1.28.13+2ca1a23
</span></span></code></pre></div></li></ol><p>Congratulations! You’ve successfully scaled your cluster up and back down to two worker nodes.</p><h2 id=summary>Summary
<a class=anchor href=#summary>#</a></h2><p>Here you learned:</p><ul><li><p>Creating a new Machine Pool for your ROSA cluster to add additional nodes to the cluster</p></li><li><p>Scaling your new Machine Pool up to add more nodes to the cluster</p></li><li><p>Scaling your Machine Pool down to remove worker nodes from the cluster</p></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#scaling-worker-nodes>Scaling Worker Nodes</a><ul><li><a href=#via-the-cli>Via the CLI</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></aside></main></body></html>